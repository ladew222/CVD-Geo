<!DOCTYPE html>
<html>
<head>
	<head>
		<title>Bootstrap Example</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
 		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
 		<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" />
		<link rel="stylesheet" href="main.css">

	</head>
	<title></title>
</head>

<body>
<script src="http://d3plus.org/js/d3.min.js"></script>
<!-- D3.js -->
<script src="https://d3plus.org/js/d3plus.v2.0.0-alpha.25.full.min.js"></script>

<script type="text/javascript">

  
function download(filename, text) {
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);

  element.style.display = 'none';
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
}

// Start file download.
download("hello.txt","This is the content of my file :)");



d3.csv("county_fips_master.csv", function(fipsData) {
  d3.csv("https://raw.githubusercontent.com/tomquisel/covid19-data/master/data/csv/2020-03-14.csv", function(cvData) {
  	let itemList=[];
  	let finalList=[];
  	cvData.forEach(function(cvItem) {    ///new RegExp('/contact\\b', 'g').test(href)
  		//const regexp = new RegExp(cvItem.county_name, 'i');
  		const result = fipsData.filter(fipsItem => fipsItem.state_name == cvItem.State_Name  && new RegExp(cvItem.County_Name, 'i').test(fipsItem.county_name));
  		if (result[0]){
  			result[0].id = "05000US"+ result[0].fips;
  			Object.assign(result[0],cvItem);
  			itemList.push(result[0]);
  		}
  		else{
  			console.log(cvItem.County_Name + " " + cvItem.State_Name + " Not Found");
  		}
  		
  	});
  	console.log();
  


	const data = itemList;

	let csv = '';
	let header = Object.keys(data[0]).join(',');
	let values = data.map(o => Object.values(o).join(',')).join('\n');

	csv += header + '\n' + values;
	console.log(csv)
	download("my.csv",csv);

 

		
     
  });
});


</script>


<div class="container-fluid">
  <h1>Hello World!</h1>
  <div class="row">
  	<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div id="viz" style="height:2000px"></div>
 
      </div>
    <div class="col-sm-3 col-md-6 col-lg-4" style="background-color:yellow;">
      <p id="value-time"></p>
    </div>
    <div class="col-sm-0 col-md-6 col-lg-8" style="background-color:pink;">
    </div>
  </div>
</div>
</body>
</html>